## -------------------------------------------------------------------------------------------------------

HOGAR <- c(1,1,1,1,2,3,3)

MIEMBRO <- c(1,2,3,4,1,1,2)

SEXO <- c("Varon","Mujer","Mujer","Varon","Mujer","Varon","Mujer")

EDAD <- c(60,54,18,27,32,71,66)

NIVEL_ED <- c("Secundario","Terciario","Secundario","Secundario","Universitario",NA,"Primario")

ESTADO <- c("Ocupado","Ocupado","Inactivo","Desocupado","Ocupado","Inactivo","Inactivo")

Datos <- data.frame(HOGAR,MIEMBRO, SEXO, EDAD, NIVEL_ED, ESTADO)

Datos


## -------------------------------------------------------------------------------------------------------------------
str(Datos)



## -------------------------------------------------------------------------------------------------------------------
summary(Datos)



## -------------------------------------------------------------------------------------------------------------------
names(Datos)


## -------------------------------------------------------------------------------------------------------------------
table(Datos$NIVEL_ED)



## -------------------------------------------------------------------------------------------------------------------
is.na(Datos)



## -------------------------------------------------------------------------------------------------------------------
is.na(Datos$HOGAR)



## -------------------------------------------------------------------------------------------------------------------
table(Datos$NIVEL_ED, exclude = NULL)



## -------------------------------------------------------------------------------------------------------------------
Datos$EDAD[2] <- NA

Datos$EDAD



## -------------------------------------------------------------------------------------------------------------------
mean(Datos$EDAD)



## -------------------------------------------------------------------------------------------------------------------
mean(Datos$EDAD, na.rm = TRUE)



## -------------------------------------------------------------------------------------------------------------------
sum(Datos$EDAD)



## -------------------------------------------------------------------------------------------------------------------
sum(Datos$EDAD, na.rm = TRUE)



## -------------------------------------------------------------------------------------------------------------------
length(Datos$EDAD)



## -------------------------------------------------------------------------------------------------------------------
Datos$EDAD[2] <- 54

Datos$EDAD



## ---- warning=FALSE,message=FALSE-----------------------------------------------------------------------------------

#install.packages("tidyverse")
library(tidyverse)



## -------------------------------------------------------------------------------------------------------------------
# Función
filter(.data = Datos, 
       EDAD > 40 & ESTADO == "Ocupado")

# Uso del "pipe"
Datos %>% 
  filter(EDAD > 40 | ESTADO == "Ocupado")


## -------------------------------------------------------------------------------------------------------------------
Datos %>% 
  rename(NMIEMBRO = MIEMBRO)


## -------------------------------------------------------------------------------------------------------------------
Datos %>% 
  mutate(EDAD_ALCUADRADO=EDAD*EDAD)



## -------------------------------------------------------------------------------------------------------------------
Datos <- Datos %>% 
  mutate(GRUPO_EDAD = case_when(EDAD < 29 ~ "Joven",
                                EDAD >=29 & EDAD<60  ~ "Adulto",
                                EDAD >=60  ~ "Adulto mayor"))
Datos


## -------------------------------------------------------------------------------------------------------------------
Datos %>% 
  select(HOGAR,MIEMBRO,SEXO)





## -------------------------------------------------------------------------------------------------------------------
 Datos %>% 
  select(-c(SEXO, GRUPO_EDAD))



## -------------------------------------------------------------------------------------------------------------------
Datos %>% 
  arrange(ESTADO, EDAD)



## -------------------------------------------------------------------------------------------------------------------
Datos %>% 
  arrange(desc(ESTADO), EDAD)



## -------------------------------------------------------------------------------------------------------------------
Datos %>% 
  summarise(Edad_prom = mean(EDAD))



## -------------------------------------------------------------------------------------------------------------------
Datos %>% 
  group_by(ESTADO) %>%
  summarise(EDAD_PROM = mean(EDAD))


## -------------------------------------------------------------------------------------------------------------------
Datos %>% 
  group_by(SEXO,ESTADO) %>%
  summarise(EDAD_PROM = mean(EDAD))


## -------------------------------------------------------------------------------------------------------------------
Datos %>% 
  filter(HOGAR == 1) %>% 
  rename(NMIEMBRO = MIEMBRO) %>% 
  mutate(GRUPO_EDAD = case_when(EDAD < 29 ~ "Joven",
                                EDAD >=29 & EDAD<60  ~ "Adulto",
                                EDAD >=60  ~ "Adulto mayor"))%>%
  select(-NIVEL_ED)
  


## -------------------------------------------------------------------------------------------------------------------
Ponderadores <- data.frame(HOGAR = c(1,2,3),
                           PONDERADOR = c(264,520,310))
Ponderadores


## -------------------------------------------------------------------------------------------------------------------
Datos_join <- Datos %>% 
  left_join(.,Ponderadores, by = "HOGAR")
Datos_join



## -------------------------------------------------------------------------------------------------------------------

Edad_prom_ponderada <- Datos_join %>% 
  summarise(Edad_prom = weighted.mean(EDAD,w = PONDERADOR))

Edad_prom_ponderada


## -------------------------------------------------------------------------------------------------------------------
datos_recorte <- Datos %>% 
  group_by(ESTADO,SEXO) %>%
  summarise(EDAD_PROM = mean(EDAD))

datos_recorte


## -------------------------------------------------------------------------------------------------------------------
datos_spread <- datos_recorte %>% 
  spread(.,          # el . llama a lo que esta atras del %>% 
  key = SEXO,        #la llave es la variable cuyos valores van a dar los nombres de columnas
  value = EDAD_PROM) #los valores con que se llenan las celdas

datos_spread  


## -------------------------------------------------------------------------------------------------------------------
##La función opuesta (gather) nos permite obtener un dataframe como el original partiendo de un dataframe como el recién construido.
  
datos_gather <- datos_spread %>%  
  gather(.,           # el . llama a lo que esta atras del %>% 
   key   = SEXO,      # como se llamará la variable que toma los nombres de las columnas 
   value = EDAD_PROM, # como se llamará la variable que toma los valores de las columnas
   2:3)               #le indico que columnas juntar

datos_gather

